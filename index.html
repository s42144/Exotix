<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exotix - Professional Crypto Trading Platform</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, update, push, onValue, query, orderByChild, equalTo } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBfR97veh6idxb81mH6N5_Gq8-CpW2D7bE",
            authDomain: "jbhigfi.firebaseapp.com",
            databaseURL: "https://jbhigfi-default-rtdb.firebaseio.com",
            projectId: "jbhigfi",
            storageBucket: "jbhigfi.firebasestorage.app",
            messagingSenderId: "736760492095",
            appId: "1:736760492095:web:47b94412495e21c561c88a",
            measurementId: "G-ZZMHC9RTVT"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);
        
        window.db = database;
        window.dbRef = ref;
        window.dbSet = set;
        window.dbGet = get;
        window.dbUpdate = update;
        window.dbPush = push;
        window.dbOnValue = onValue;
        window.dbQuery = query;
        window.dbOrderByChild = orderByChild;
        window.dbEqualTo = equalTo;
        window.firebaseAuth = auth;
        window.signInAnon = signInAnonymously;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #6C5CE7;
            --secondary-color: #A29BFE;
            --success-color: #00B894;
            --danger-color: #FF7675;
            --warning-color: #FDCB6E;
            --dark-bg: #0F0F1E;
            --card-bg: #1A1A2E;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0B0;
            --border-color: #2D2D44;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0F0F1E 0%, #1A1A2E 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(108, 92, 231, 0.1);
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .balance-display {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(108, 92, 231, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
        }

        .balance-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }

        .balance-amount {
            font-size: 20px;
            font-weight: bold;
            color: var(--success-color);
        }

        /* Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s;
            padding: 5px 15px;
            border-radius: 10px;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(108, 92, 231, 0.2);
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-icon {
            font-size: 24px;
        }

        .nav-label {
            font-size: 12px;
        }

        /* Sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Trading Plans */
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .plan-card {
            background: linear-gradient(135deg, var(--card-bg) 0%, #252540 100%);
            border-radius: 20px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 12px 40px rgba(108, 92, 231, 0.3);
        }

        .plan-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .plan-pair {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .plan-logo {
            width: 50px;
            height: 50px;
            background: rgba(108, 92, 231, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .plan-chart {
            height: 120px;
            margin: 15px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 10px;
        }

        .plan-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .detail-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 10px;
        }

        .detail-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--success-color);
        }

        .plan-price {
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: var(--primary-color);
        }

        .buy-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .buy-button:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4);
        }

        .buy-button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        .purchased-button {
            background: var(--success-color) !important;
        }

        /* My Trades */
        .active-trades {
            display: grid;
            gap: 20px;
        }

        .trade-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid var(--primary-color);
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .trade-pair {
            font-size: 20px;
            font-weight: bold;
        }

        .trade-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            background: var(--success-color);
        }

        .progress-bar-container {
            margin: 20px 0;
            position: relative;
            height: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 20px;
            transition: width 0.3s;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 14px;
        }

        .countdown-timer {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--warning-color);
            margin: 15px 0;
        }

        .claim-button {
            width: 100%;
            padding: 15px;
            background: var(--success-color);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .claim-button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }

        /* Wallet */
        .wallet-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .wallet-tab {
            padding: 12px 25px;
            background: var(--card-bg);
            border: none;
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .wallet-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .wallet-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .qr-container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            margin: 20px 0;
        }

        .copy-button {
            background: var(--primary-color);
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s;
        }

        .copy-button:hover {
            background: var(--secondary-color);
        }

        .address-box {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            word-break: break-all;
        }

        .timer-display {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            color: var(--danger-color);
            margin: 20px 0;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th,
        .history-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .history-table th {
            background: rgba(108, 92, 231, 0.1);
            font-weight: bold;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-pending {
            background: var(--warning-color);
            color: var(--dark-bg);
        }

        .status-approved {
            background: var(--success-color);
            color: white;
        }

        .status-rejected {
            background: var(--danger-color);
            color: white;
        }

        /* Referrals */
        .referral-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--border-color);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .referral-link-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .referral-link {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .referral-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .referral-item {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .referral-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
        }

        .referral-info {
            flex: 1;
        }

        .referral-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .referral-earnings {
            color: var(--success-color);
            font-size: 14px;
        }

        .share-button {
            background: linear-gradient(135deg, #0088cc, #00aced);
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .share-button:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 136, 204, 0.4);
        }

        /* Profile */
        .profile-header {
            text-align: center;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px;
            border: 4px solid var(--primary-color);
        }

        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-id {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .redeem-section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s;
            display: none;
        }

        .toast.active {
            display: block;
        }

        .toast.success {
            border-left: 4px solid var(--success-color);
        }

        .toast.error {
            border-left: 4px solid var(--danger-color);
        }

        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .plans-grid {
                grid-template-columns: 1fr;
            }

            .history-table {
                font-size: 12px;
            }

            .history-table th,
            .history-table td {
                padding: 10px 5px;
            }
        }

        .rules-box {
            background: rgba(108, 92, 231, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
        }

        .rules-box h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .rules-box ul {
            list-style: none;
            padding: 0;
        }

        .rules-box li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .rules-box li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: var(--success-color);
            font-weight: bold;
        }

        .live-price {
            display: inline-block;
            padding: 5px 12px;
            background: rgba(0, 184, 148, 0.2);
            border-radius: 8px;
            color: var(--success-color);
            font-weight: bold;
            margin-left: 10px;
        }

        .price-change {
            font-size: 12px;
            margin-left: 5px;
        }

        .price-up {
            color: var(--success-color);
        }

        .price-down {
            color: var(--danger-color);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .submit-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .submit-button:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4);
        }

        .submit-button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Header -->
    <div class="header">
        <div class="logo">EXOTIX</div>
        <div class="balance-display">
            <img src="https://i.postimg.cc/kG1SJTf9/Screenshot-2025-10-09-23-39-32-878-com-ton-keeper-edit.jpg" alt="USDT" class="balance-icon" onerror="this.style.display='none'">
            <div>
                <div style="font-size: 12px; color: var(--text-secondary);">Balance</div>
                <div class="balance-amount" id="userBalance">$0.00</div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Trade Section -->
        <div class="section active" id="tradeSection">
            <h2 style="margin-bottom: 20px;">Investment Plans</h2>
            <div class="plans-grid" id="plansGrid"></div>
        </div>

        <!-- My Trades Section -->
        <div class="section" id="myTradesSection">
            <h2 style="margin-bottom: 20px;">My Active Trades</h2>
            <div class="active-trades" id="activeTrades"></div>
        </div>

        <!-- Wallet Section -->
        <div class="section" id="walletSection">
            <h2 style="margin-bottom: 20px;">Wallet</h2>
            <div class="wallet-tabs">
                <button class="wallet-tab active" onclick="switchWalletTab('deposit')">Deposit</button>
                <button class="wallet-tab" onclick="switchWalletTab('withdraw')">Withdraw</button>
                <button class="wallet-tab" onclick="switchWalletTab('history')">History</button>
                <button class="wallet-tab" onclick="switchWalletTab('activities')">Activities</button>
            </div>

            <!-- Deposit Tab -->
            <div class="wallet-content" id="depositTab">
                <div class="form-group">
                    <label class="form-label">Deposit Amount (Min: $30)</label>
                    <input type="number" class="form-input" id="depositAmount" placeholder="Enter amount" min="30">
                </div>
                <button class="submit-button" onclick="initiateDeposit()">Confirm Deposit</button>
            </div>

            <!-- Deposit Confirmation -->
            <div class="wallet-content" id="depositConfirmation" style="display: none;">
                <div class="timer-display" id="depositTimer">15:00</div>
                
                <div class="qr-container">
                    <canvas id="qrCode"></canvas>
                </div>

                <div class="form-group">
                    <label class="form-label">Wallet Address (TON Chain)</label>
                    <div class="address-box">
                        <span id="walletAddress">UQBWOgFgB4B8qBCo8CNjDUNAtvUSosw4v7v9gkt0GVOaNLSz</span>
                        <button class="copy-button" onclick="copyToClipboard('walletAddress')">üìã</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <div class="address-box">
                        <span id="depositAmountDisplay">$0.00</span>
                        <button class="copy-button" onclick="copyToClipboard('depositAmountDisplay')">üìã</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Memo/Comment (IMPORTANT)</label>
                    <div class="address-box">
                        <span id="depositMemo">ExotixDP_</span>
                        <button class="copy-button" onclick="copyToClipboard('depositMemo')">üìã</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Network</label>
                    <div class="address-box">
                        <span>TON</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Transaction Hash</label>
                    <input type="text" class="form-input" id="txHash" placeholder="Enter transaction hash">
                </div>

                <button class="submit-button" onclick="submitDeposit()">Submit Transaction</button>
                <button class="submit-button" style="background: var(--danger-color); margin-top: 10px;" onclick="cancelDeposit()">Cancel</button>
            </div>

            <!-- Withdraw Tab -->
            <div class="wallet-content" id="withdrawTab" style="display: none;">
                <div class="form-group">
                    <label class="form-label">USDT TON Chain Address *</label>
                    <input type="text" class="form-input" id="withdrawAddress" placeholder="Enter your USDT TON address" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Amount (Min: $0.10) *</label>
                    <input type="number" class="form-input" id="withdrawAmount" placeholder="Enter amount" min="0.10" step="0.01" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Memo/Comment (Optional)</label>
                    <input type="text" class="form-input" id="withdrawMemo" placeholder="Enter memo (optional)">
                </div>

                <button class="submit-button" onclick="submitWithdraw()">Submit Withdrawal</button>
            </div>

            <!-- History Tab -->
            <div class="wallet-content" id="historyTab" style="display: none;">
                <div style="overflow-x: auto;">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="4" class="empty-state">
                                    <div class="empty-state-icon">üìä</div>
                                    <div>No transaction history yet</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Activities Tab -->
            <div class="wallet-content" id="activitiesTab" style="display: none;">
                <div style="overflow-x: auto;">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Activity</th>
                                <th>Details</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="activitiesTableBody">
                            <tr>
                                <td colspan="3" class="empty-state">
                                    <div class="empty-state-icon">üìù</div>
                                    <div>No activities yet</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Referrals Section -->
        <div class="section" id="referralsSection">
            <h2 style="margin-bottom: 20px;">Referral Program</h2>

            <div class="rules-box">
                <h3>üìã Referral Rules</h3>
                <ul>
                    <li>Earn $0.20 bonus for each new referral</li>
                    <li>Get 20% commission on all referral deposits</li>
                    <li>Earn 20% commission on referral trading profits</li>
                    <li>Commissions are added to your balance in real-time</li>
                    <li>No limit on number of referrals</li>
                    <li>Lifetime earnings from your referrals</li>
                </ul>
            </div>

            <div class="referral-stats">
                <div class="stat-card">
                    <div class="stat-label">Total Referrals</div>
                    <div class="stat-value" id="totalReferrals">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Earnings</div>
                    <div class="stat-value" id="totalReferralEarnings">$0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">This Month</div>
                    <div class="stat-value" id="monthlyEarnings">$0.00</div>
                </div>
            </div>

            <div class="referral-link-box">
                <h3 style="margin-bottom: 15px;">Your Referral Link</h3>
                <div class="referral-link">
                    <input type="text" class="form-input" id="referralLink" readonly style="flex: 1; margin: 0;">
                    <button class="copy-button" onclick="copyToClipboard('referralLink')">üìã</button>
                </div>
                <button class="share-button" onclick="shareOnTelegram()">üì± Share on Telegram</button>
            </div>

            <button class="submit-button" onclick="showReferralList()" style="margin: 20px 0;">üë• Show My Referrals</button>

            <div class="referral-list" id="referralList" style="display: none;"></div>
        </div>

        <!-- Profile Section -->
        <div class="section" id="profileSection">
            <div class="profile-header">
                <img src="" alt="Profile" class="profile-avatar" id="profileAvatar" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%236C5CE7%22/%3E%3Ctext x=%2250%22 y=%2265%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22%3EU%3C/text%3E%3C/svg%3E'">
                <div class="profile-name" id="profileName">User</div>
                <div class="profile-id">ID: <span id="profileUserId">000000</span></div>
            </div>

            <div class="redeem-section">
                <h3 style="margin-bottom: 20px;">üéÅ Redeem Code</h3>
                <div class="form-group">
                    <label class="form-label">Enter 8-Digit Redemption Code</label>
                    <input type="text" class="form-input" id="redeemCode" placeholder="XXXXXXXX" maxlength="8">
                </div>
                <button class="submit-button" onclick="redeemCode()">Redeem Now</button>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: var(--card-bg); border-radius: 15px;">
                <h3 style="margin-bottom: 15px;">Account Statistics</h3>
                <div class="referral-stats">
                    <div class="stat-card">
                        <div class="stat-label">Total Invested</div>
                        <div class="stat-value" id="totalInvested">$0.00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Earned</div>
                        <div class="stat-value" id="totalEarned">$0.00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Plans</div>
                        <div class="stat-value" id="activePlansCount">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchSection('trade')">
            <div class="nav-icon">üìà</div>
            <div class="nav-label">Trade</div>
        </div>
        <div class="nav-item" onclick="switchSection('myTrades')">
            <div class="nav-icon">üíº</div>
            <div class="nav-label">My Trades</div>
        </div>
        <div class="nav-item" onclick="switchSection('wallet')">
            <div class="nav-icon">üí∞</div>
            <div class="nav-label">Wallet</div>
        </div>
        <div class="nav-item" onclick="switchSection('referrals')">
            <div class="nav-icon">üë•</div>
            <div class="nav-label">Referrals</div>
        </div>
        <div class="nav-item" onclick="switchSection('profile')">
            <div class="nav-icon">üë§</div>
            <div class="nav-label">Profile</div>
        </div>
    </div>

    <script>
        // Global Variables
        const TELEGRAM_BOT_TOKEN = '7930967027:AAG3AkEZrkKGxTFOyVHwN8VpA9HgusAdRmw';
        const WALLET_ADDRESS = 'UQBWOgFgB4B8qBCo8CNjDUNAtvUSosw4v7v9gkt0GVOaNLSz';
        const MIN_DEPOSIT = 30;
        const MIN_WITHDRAW = 0.10;
        const REFERRAL_BONUS = 0.20;
        const REFERRAL_COMMISSION = 0.20; // 20%

        let currentUser = null;
        let depositTimer = null;
        let priceUpdateInterval = null;

        // Trading Plans Data
        const tradingPlans = [
            { pair: 'BTC/USDT', price: 3000, dailyEarning: 300, duration: 30, minPrice: 40, icon: '‚Çø' },
            { pair: 'ETH/USDT', price: 2000, dailyEarning: 200, duration: 30, minPrice: 40, icon: 'Œû' },
            { pair: 'BNB/USDT', price: 1500, dailyEarning: 150, duration: 30, minPrice: 40, icon: 'üî∂' },
            { pair: 'SOL/USDT', price: 1200, dailyEarning: 120, duration: 30, minPrice: 40, icon: '‚óé' },
            { pair: 'XRP/USDT', price: 1000, dailyEarning: 100, duration: 30, minPrice: 40, icon: '‚úï' },
            { pair: 'ADA/USDT', price: 900, dailyEarning: 90, duration: 30, minPrice: 40, icon: '‚Ç≥' },
            { pair: 'DOGE/USDT', price: 800, dailyEarning: 80, duration: 30, minPrice: 40, icon: '√ê' },
            { pair: 'DOT/USDT', price: 750, dailyEarning: 75, duration: 30, minPrice: 40, icon: '‚óè' },
            { pair: 'MATIC/USDT', price: 700, dailyEarning: 70, duration: 30, minPrice: 40, icon: '‚¨°' },
            { pair: 'AVAX/USDT', price: 650, dailyEarning: 65, duration: 30, minPrice: 40, icon: 'üî∫' },
            { pair: 'LINK/USDT', price: 600, dailyEarning: 60, duration: 30, minPrice: 40, icon: 'üîó' },
            { pair: 'UNI/USDT', price: 550, dailyEarning: 55, duration: 30, minPrice: 40, icon: 'ü¶Ñ' },
            { pair: 'LTC/USDT', price: 500, dailyEarning: 50, duration: 30, minPrice: 40, icon: '≈Å' },
            { pair: 'ATOM/USDT', price: 450, dailyEarning: 45, duration: 30, minPrice: 40, icon: '‚öõ' },
            { pair: 'XLM/USDT', price: 400, dailyEarning: 40, duration: 30, minPrice: 40, icon: '‚ú¶' },
            { pair: 'TRX/USDT', price: 350, dailyEarning: 35, duration: 30, minPrice: 40, icon: '‚ñ≤' },
            { pair: 'ETC/USDT', price: 300, dailyEarning: 30, duration: 30, minPrice: 40, icon: 'Œû' },
            { pair: 'FIL/USDT', price: 250, dailyEarning: 25, duration: 30, minPrice: 40, icon: '‚®é' },
            { pair: 'ALGO/USDT', price: 200, dailyEarning: 20, duration: 30, minPrice: 40, icon: '‚ó¨' },
            { pair: 'VET/USDT', price: 150, dailyEarning: 15, duration: 30, minPrice: 40, icon: 'V' }
        ];

        // Initialize App
        async function initApp() {
            showLoading(true);
            
            try {
                // Initialize Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    tg.ready();
                    tg.expand();
                    
                    const user = tg.initDataUnsafe.user;
                    if (user) {
                        currentUser = {
                            id: user.id,
                            firstName: user.first_name || 'User',
                            lastName: user.last_name || '',
                            username: user.username || '',
                            photoUrl: user.photo_url || ''
                        };
                    }
                }

                // Fallback for testing
                if (!currentUser) {
                    currentUser = {
                        id: Math.floor(Math.random() * 1000000),
                        firstName: 'Test',
                        lastName: 'User',
                        username: 'testuser',
                        photoUrl: ''
                    };
                }

                // Sign in to Firebase
                await window.signInAnon(window.firebaseAuth);

                // Initialize user data
                await initializeUserData();

                // Load user data
                await loadUserData();

                // Render plans
                renderTradingPlans();

                // Start price updates
                startPriceUpdates();

                // Load active trades
                loadActiveTrades();

                // Load transaction history
                loadTransactionHistory();

                // Load referral data
                loadReferralData();

                // Update profile
                updateProfile();

                showLoading(false);
            } catch (error) {
                console.error('Initialization error:', error);
                showToast('Error initializing app', 'error');
                showLoading(false);
            }
        }

        // Initialize User Data
        async function initializeUserData() {
            const userRef = window.dbRef(window.db, `users/${currentUser.id}`);
            const snapshot = await window.dbGet(userRef);

            if (!snapshot.exists()) {
                const userData = {
                    id: currentUser.id,
                    firstName: currentUser.firstName,
                    lastName: currentUser.lastName,
                    username: currentUser.username,
                    photoUrl: currentUser.photoUrl,
                    balance: 0,
                    totalInvested: 0,
                    totalEarned: 0,
                    referralCode: currentUser.id.toString(),
                    referredBy: null,
                    referrals: [],
                    referralEarnings: 0,
                    createdAt: Date.now()
                };

                await window.dbSet(userRef, userData);

                // Check for referral
                const urlParams = new URLSearchParams(window.location.search);
                const referrerId = urlParams.get('ref');
                if (referrerId && referrerId !== currentUser.id.toString()) {
                    await processReferral(referrerId);
                }
            }
        }

        // Process Referral
        async function processReferral(referrerId) {
            try {
                const userRef = window.dbRef(window.db, `users/${currentUser.id}`);
                const referrerRef = window.dbRef(window.db, `users/${referrerId}`);

                const referrerSnapshot = await window.dbGet(referrerRef);
                if (referrerSnapshot.exists()) {
                    // Update current user
                    await window.dbUpdate(userRef, {
                        referredBy: referrerId
                    });

                    // Update referrer
                    const referrerData = referrerSnapshot.val();
                    const referrals = referrerData.referrals || [];
                    referrals.push(currentUser.id);

                    const newBalance = (referrerData.balance || 0) + REFERRAL_BONUS;
                    const newEarnings = (referrerData.referralEarnings || 0) + REFERRAL_BONUS;

                    await window.dbUpdate(referrerRef, {
                        referrals: referrals,
                        balance: newBalance,
                        referralEarnings: newEarnings
                    });

                    // Log activity
                    await logActivity(referrerId, 'referral_bonus', `New referral: ${currentUser.firstName}`, REFERRAL_BONUS);

                    // Send Telegram notification
                    await sendTelegramNotification(referrerId, `üéâ New Referral! ${currentUser.firstName} joined using your link. You earned $${REFERRAL_BONUS}!`);
                }
            } catch (error) {
                console.error('Error processing referral:', error);
            }
        }

        // Load User Data
        async function loadUserData() {
            const userRef = window.dbRef(window.db, `users/${currentUser.id}`);
            window.dbOnValue(userRef, (snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    document.getElementById('userBalance').textContent = `$${(userData.balance || 0).toFixed(2)}`;
                    document.getElementById('totalInvested').textContent = `$${(userData.totalInvested || 0).toFixed(2)}`;
                    document.getElementById('totalEarned').textContent = `$${(userData.totalEarned || 0).toFixed(2)}`;
                }
            });
        }

        // Render Trading Plans
        function renderTradingPlans() {
            const plansGrid = document.getElementById('plansGrid');
            plansGrid.innerHTML = '';

            tradingPlans.forEach((plan, index) => {
                const card = document.createElement('div');
                card.className = 'plan-card';
                
                const livePrice = (plan.price * (0.95 + Math.random() * 0.1)).toFixed(2);
                const priceChange = (Math.random() * 10 - 5).toFixed(2);
                const priceChangeClass = priceChange >= 0 ? 'price-up' : 'price-down';
                const priceChangeSymbol = priceChange >= 0 ? '‚ñ≤' : '‚ñº';

                card.innerHTML = `
                    <div class="plan-header">
                        <div>
                            <div class="plan-pair">${plan.pair}</div>
                            <div class="live-price">$${livePrice} <span class="price-change ${priceChangeClass}">${priceChangeSymbol} ${Math.abs(priceChange)}%</span></div>
                        </div>
                        <div class="plan-logo">${plan.icon}</div>
                    </div>
                    <div class="plan-chart">
                        <canvas id="chart-${index}"></canvas>
                    </div>
                    <div class="plan-details">
                        <div class="detail-item">
                            <div class="detail-label">Daily Earning</div>
                            <div class="detail-value">$${plan.dailyEarning}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Duration</div>
                            <div class="detail-value">${plan.duration} Days</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Total Return</div>
                            <div class="detail-value">$${plan.dailyEarning * plan.duration}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ROI</div>
                            <div class="detail-value">${((plan.dailyEarning * plan.duration / plan.price) * 100).toFixed(0)}%</div>
                        </div>
                    </div>
                    <div class="plan-price">$${plan.price}</div>
                    <button class="buy-button" id="buy-btn-${index}" onclick="buyPlan(${index})">
                        BUY NOW
                    </button>
                `;

                plansGrid.appendChild(card);

                // Create mini chart
                setTimeout(() => createMiniChart(`chart-${index}`), 100);
            });

            // Check purchased plans
            checkPurchasedPlans();
        }

        // Create Mini Chart
        function createMiniChart(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const data = Array.from({ length: 20 }, () => Math.random() * 100 + 50);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: 20 }, (_, i) => ''),
                    datasets: [{
                        data: data,
                        borderColor: '#6C5CE7',
                        backgroundColor: 'rgba(108, 92, 231, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }

        // Check Purchased Plans
        async function checkPurchasedPlans() {
            const tradesRef = window.dbRef(window.db, `trades/${currentUser.id}`);
            const snapshot = await window.dbGet(tradesRef);

            if (snapshot.exists()) {
                const trades = snapshot.val();
                Object.values(trades).forEach(trade => {
                    if (trade.status === 'active') {
                        const planIndex = tradingPlans.findIndex(p => p.pair === trade.pair);
                        if (planIndex !== -1) {
                            const button = document.getElementById(`buy-btn-${planIndex}`);
                            if (button) {
                                button.textContent = 'PURCHASED';
                                button.classList.add('purchased-button');
                                button.disabled = true;
                            }
                        }
                    }
                });
            }
        }

        // Buy Plan
        async function buyPlan(index) {
            const plan = tradingPlans[index];
            
            showLoading(true);

            try {
                // Check balance
                const userRef = window.dbRef(window.db, `users/${currentUser.id}`);
                const snapshot = await window.dbGet(userRef);
                const userData = snapshot.val();

                if (userData.balance < plan.price) {
                    showToast('Insufficient balance. Please deposit funds.', 'error');
                    showLoading(false);
                    return;
                }

                // Check if already purchased
                const tradesRef = window.dbRef(window.db, `trades/${currentUser.id}`);
                const tradesSnapshot = await window.dbGet(tradesRef);
                
                if (tradesSnapshot.exists()) {
                    const trades = Object.values(tradesSnapshot.val());
                    const existingTrade = trades.find(t => t.pair === plan.pair && t.status === 'active');
                    if (existingTrade) {
                        showToast('You have already purchased this plan', 'warning');
                        showLoading(false);
                        return;
                    }
                }

                // Create trade
                const tradeData = {
                    userId: currentUser.id,
                    pair: plan.pair,
                    price: plan.price,
                    dailyEarning: plan.dailyEarning,
                    duration: plan.duration,
                    daysRemaining: plan.duration,
                    totalEarned: 0,
                    lastClaimTime: Date.now(),
                    nextClaimTime: Date.now() + (24 * 60 * 60 * 1000),
                    status: 'active',
                    createdAt: Date.now()
                };

                const newTradeRef = window.dbPush(tradesRef);
                await window.dbSet(newTradeRef, tradeData);

                // Update user balance and stats
                const newBalance = userData.balance - plan.price;
                const newTotalInvested = (userData.totalInvested || 0) + plan.price;

                await window.dbUpdate(userRef, {
                    balance: newBalance,
                    totalInvested: newTotalInvested
                });

                // Log activity
                await logActivity(currentUser.id, 'plan_purchase', `Purchased ${plan.pair} plan`, -plan.price);

                // Send Telegram notification
                await sendTelegramNotification(currentUser.id, `‚úÖ Successfully purchased ${plan.pair} plan for $${plan.price}!`);

                // Process referral commission
                if (userData.referredBy) {
                    await processReferralCommission(userData.referredBy, plan.price, 'deposit');
                }

                showToast('Plan purchased successfully!', 'success');
                
                // Update UI
                const button = document.getElementById(`buy-btn-${index}`);
                button.textContent = 'PURCHASED';
                button.classList.add('purchased-button');
                button.disabled = true;

                loadActiveTrades();
                showLoading(false);

            } catch (error) {
                console.error('Error buying plan:', error);
                showToast('Error purchasing plan', 'error');
                showLoading(false);
            }
        }

        // Load Active Trades
        async function loadActiveTrades() {
            const tradesRef = window.dbRef(window.db, `trades/${currentUser.id}`);
            
            window.dbOnValue(tradesRef, (snapshot) => {
                const activeTrades = document.getElementById('activeTrades');
                activeTrades.innerHTML = '';

                if (!snapshot.exists()) {
                    activeTrades.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìä</div>
                            <div>No active trades yet</div>
                            <div style="margin-top: 10px; color: var(--text-secondary);">Purchase a plan to start earning</div>
                        </div>
                    `;
                    document.getElementById('activePlansCount').textContent = '0';
                    return;
                }

                const trades = snapshot.val();
                const activeTradesArray = Object.entries(trades).filter(([_, trade]) => trade.status === 'active');
                
                document.getElementById('activePlansCount').textContent = activeTradesArray.length;

                activeTradesArray.forEach(([tradeId, trade]) => {
                    const card = document.createElement('div');
                    card.className = 'trade-card';

                    const timeUntilClaim = trade.nextClaimTime - Date.now();
                    const canClaim = timeUntilClaim <= 0;
                    const progress = ((trade.duration - trade.daysRemaining) / trade.duration) * 100;

                    card.innerHTML = `
                        <div class="trade-header">
                            <div class="trade-pair">${trade.pair}</div>
                            <div class="trade-status">Active</div>
                        </div>
                        <div class="plan-details">
                            <div class="detail-item">
                                <div class="detail-label">Investment</div>
                                <div class="detail-value">$${trade.price}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Daily Earning</div>
                                <div class="detail-value">$${trade.dailyEarning}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Total Earned</div>
                                <div class="detail-value">$${trade.totalEarned.toFixed(2)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Days Left</div>
                                <div class="detail-value">${trade.daysRemaining}</div>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${progress}%"></div>
                            <div class="progress-text">${progress.toFixed(0)}% Complete</div>
                        </div>
                        <div class="countdown-timer" id="timer-${tradeId}">
                            ${canClaim ? 'Ready to Claim!' : formatTime(timeUntilClaim)}
                        </div>
                        <button class="claim-button" id="claim-${tradeId}" 
                                ${canClaim ? '' : 'disabled'} 
                                onclick="claimEarnings('${tradeId}')">
                            ${canClaim ? 'CLAIM NOW' : 'CLAIM IN PROGRESS'}
                        </button>
                    `;

                    activeTrades.appendChild(card);

                    // Update countdown
                    if (!canClaim) {
                        setInterval(() => {
                            const timer = document.getElementById(`timer-${tradeId}`);
                            const button = document.getElementById(`claim-${tradeId}`);
                            const remaining = trade.nextClaimTime - Date.now();
                            
                            if (remaining <= 0) {
                                if (timer) timer.textContent = 'Ready to Claim!';
                                if (button) {
                                    button.disabled = false;
                                    button.textContent = 'CLAIM NOW';
                                }
                            } else {
                                if (timer) timer.textContent = formatTime(remaining);
                            }
                        }, 1000);
                    }
                });
            });
        }

        // Claim Earnings
        async function claimEarnings(tradeId) {
            showLoading(true);

            try {
                const tradeRef = window.dbRef(window.db, `trades/${currentUser.id}/${tradeId}`);
                const snapshot = await window.dbGet(tradeRef);
                const trade = snapshot.val();

                if (!trade || trade.status !== 'active') {
                    showToast('Trade not found or inactive', 'error');
                    showLoading(false);
                    return;
                }

                const timeUntilClaim = trade.nextClaimTime - Date.now();
                if (timeUntilClaim > 0) {
                    showToast('Please wait until next claim time', 'warning');
                    showLoading(false);
                    return;
                }

                // Update trade
                const newDaysRemaining = trade.daysRemaining - 1;
                const newTotalEarned = trade.totalEarned + trade.dailyEarning;
                const newStatus = newDaysRemaining <= 0 ? 'completed' : 'active';

                await window.dbUpdate(tradeRef, {
                    daysRemaining: newDaysRemaining,
                    totalEarned: newTotalEarned,
                    lastClaimTime: Date.now(),
                    nextClaimTime: Date.now() + (24 * 60 * 60 * 1000),
                    status: newStatus
                });

                // Update user balance
                const userRef = window.dbRef(window.db, `users/${currentUser.id}`);
                const userSnapshot = await window.dbGet(userRef);
                const userData = userSnapshot.val();

                const newBalance = userData.balance + trade.dailyEarning;
                const newTotalEarned = (userData.totalEarned || 0) + trade.dailyEarning;

                await window.dbUpdate(userRef, {
                    balance: newBalance,
                    totalEarned: newTotalEarned
                });

                // Log activity
                await logActivity(currentUser.id, 'claim_earnings', `Claimed $${trade.dailyEarning} from ${trade.pair}`, trade.dailyEarning);

                // Send Telegram notification
                await sendTelegramNotification(currentUser.id, `üí∞ Successfully claimed $${trade.dailyEarning} from ${trade.pair}!`);

                // Process referral commission
                if (userData.referredBy) {
                    await processReferralCommission(userData.referredBy, trade.dailyEarning, 'trade');
                }

                showToast(`Successfully claimed $${trade.dailyEarning}!`, 'success');
                showLoading(false);

            } catch (error) {
                console.error('Error claiming earnings:', error);
                showToast('Error claiming earnings', 'error');
                showLoading(false);
            }
        }

        // Process Referral Commission
        async function processReferralCommission(referrerId, amount, type) {
            try {
                const commission = amount * REFERRAL_COMMISSION;
                const referrerRef = window.dbRef(window.db, `users/${referrerId}`);
                const snapshot = await window.dbGet(referrerRef);

                if (snapshot.exists()) {
                    const referrerData = snapshot.val();
                    const newBalance = (referrerData.balance || 0) + commission;
                    const newEarnings = (referrerData.referralEarnings || 0) + commission;

                    await window.dbUpdate(referrerRef, {
                        balance: newBalance,
                        referralEarnings: newEarnings
                    });

                    // Log activity
                    await logActivity(referrerId, 'referral_commission', `Earned $${commission.toFixed(2)} commission from ${type}`, commission);

                    // Send notification
                    await sendTelegramNotification(referrerId, `üíµ You earned $${commission.toFixed(2)} commission from your referral's ${type}!`);
                }
            } catch (error) {
                console.error('Error processing referral commission:', error);
            }
        }

        // Wallet Functions
        function switchWalletTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.wallet-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Hide all tabs
            document.getElementById('depositTab').style.display = 'none';
            document.getElementById('depositConfirmation').style.display = 'none';
            document.getElementById('withdrawTab').style.display = 'none';
            document.getElementById('historyTab').style.display = 'none';
            document.getElementById('activitiesTab').style.display = 'none';

            // Show selected tab
            if (tab === 'deposit') {
                document.getElementById('depositTab').style.display = 'block';
            } else if (tab === 'withdraw') {
                document.getElementById('withdrawTab').style.display = 'block';
            } else if (tab === 'history') {
                document.getElementById('historyTab').style.display = 'block';
                loadTransactionHistory();
            } else if (tab === 'activities') {
                document.getElementById('activitiesTab').style.display = 'block';
                loadActivities();
            }
        }

        // Initiate Deposit
        function initiateDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);

            if (!amount || amount < MIN_DEPOSIT) {
                showToast(`Minimum deposit is $${MIN_DEPOSIT}`, 'warning');
                return;
            }

            // Show confirmation screen
            document.getElementById('depositTab').style.display = 'none';
            document.getElementById('depositConfirmation').style.display = 'block';

            // Set deposit details
            document.getElementById('depositAmountDisplay').textContent = `$${amount.toFixed(2)}`;
            document.getElementById('depositMemo').textContent = `ExotixDP_${currentUser.id}`;

            // Generate QR code
            const qrData = `ton://transfer/${WALLET_ADDRESS}?amount=${amount}&text=ExotixDP_${currentUser.id}`;
            QRCode.toCanvas(document.getElementById('qrCode'), qrData, {
                width: 250,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            });

            // Start timer
            startDepositTimer();
        }

        // Start Deposit Timer
        function startDepositTimer() {
            let timeLeft = 15 * 60; // 15 minutes

            if (depositTimer) clearInterval(depositTimer);

            depositTimer = setInterval(() => {
                timeLeft--;

                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('depositTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(depositTimer);
                    cancelDeposit();
                    showToast('Deposit time expired', 'warning');
                }
            }, 1000);
        }

        // Submit Deposit
        async function submitDeposit() {
            const amount = parseFloat(document.getElementById('depositAmountDisplay').textContent.replace('$', ''));
            const txHash = document.getElementById('txHash').value.trim();

            if (!txHash) {
                showToast('Please enter transaction hash', 'warning');
                return;
            }

            showLoading(true);

            try {
                // Create deposit request
                const depositData = {
                    userId: currentUser.id,
                    amount: amount,
                    txHash: txHash,
                    address: WALLET_ADDRESS,
                    memo: `ExotixDP_${currentUser.id}`,
                    network: 'TON',
                    status: 'pending',
                    type: 'deposit',
                    createdAt: Date.now()
                };

                const depositsRef = window.dbRef(window.db, 'deposits');
                const newDepositRef = window.dbPush(depositsRef);
                await window.dbSet(newDepositRef, depositData);

                // Log activity
                await logActivity(currentUser.id, 'deposit_request', `Deposit request for $${amount}`, 0);

                // Send Telegram notification to admin
                await sendTelegramNotification('ADMIN', `üí≥ New deposit request:\nUser: ${currentUser.firstName} (${currentUser.id})\nAmount: $${amount}\nTx Hash: ${txHash}`);

                clearInterval(depositTimer);
                cancelDeposit();
                
                showToast('Deposit request submitted! Waiting for confirmation.', 'success');
                showLoading(false);

            } catch (error) {
                console.error('Error submitting deposit:', error);
                showToast('Error submitting deposit', 'error');
                showLoading(false);
            }
        }

        // Cancel Deposit
        function cancelDeposit() {
            if (depositTimer) clearInterval(depositTimer);
            document.getElementById('depositConfirmation').style.display = 'none';
            document.getElementById('depositTab').style.display = 'block';
            document.getElementById('depositAmount').value = '';
            document.getElementById('txHash').value = '';
        }

        // Submit Withdraw
        async function submitWithdraw() {
            const address = document.getElementById('withdrawAddress').value.trim();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const memo = document.getElementById('withdrawMemo').value.trim();

            if (!address) {
                showToast('Please enter withdrawal address', 'warning');
                return;
            }

            if (!amount || amount < MIN_WITHDRAW) {
                showToast(`Minimum withdrawal is $${MIN_WITHDRAW}`, 'warning');
                return;
            }

            showLoading(true);

            try {
                // Check balance
                const userRef = window.dbRef(window.db, `users/${currentUser.id}`);
                const snapshot = await window.dbGet(userRef);
                const userData = snapshot.val();

                if (userData.balance < amount) {
                    showToast('Insufficient balance', 'error');
                    showLoading(false);
                    return;
                }

                // Create withdrawal request
                const withdrawData = {
                    userId: currentUser.id,
                    amount: amount,
                    address: address,
                    memo: memo,
                    network: 'TON',
                    status: 'pending',
                    type: 'withdraw',
                    createdAt: Date.now()
                };

                const withdrawalsRef = window.dbRef(window.db, 'withdrawals');
                const newWithdrawRef = window.dbPush(withdrawalsRef);
                await window.dbSet(newWithdrawRef, withdrawData);

                // Deduct from balance temporarily
                await window.dbUpdate(userRef, {
                    balance: userData.balance - amount
                });

                // Log activity
                await logActivity(currentUser.id, 'withdraw_request', `Withdrawal request for $${amount}`, -amount);

                // Send Telegram notification to admin
                await sendTelegramNotification('ADMIN', `üí∏ New withdrawal request:\nUser: ${currentUser.firstName} (${currentUser.id})\nAmount: $${amount}\nAddress: ${address}`);

                // Clear form
                document.getElementById('withdrawAddress').value = '';
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('withdrawMemo').value = '';

                showToast('Withdrawal request submitted!', 'success');
                showLoading(false);

            } catch (error) {
                console.error('Error submitting withdrawal:', error);
                showToast('Error submitting withdrawal', 'error');
                showLoading(false);
            }
        }

        // Load Transaction History
        async function loadTransactionHistory() {
            const historyBody = document.getElementById('historyTableBody');
            historyBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Loading...</td></tr>';

            try {
                // Load deposits
                const depositsRef = window.dbRef(window.db, 'deposits');
                const depositsQuery = window.dbQuery(depositsRef, window.dbOrderByChild('userId'), window.dbEqualTo(currentUser.id));
                const depositsSnapshot = await window.dbGet(depositsQuery);

                // Load withdrawals
                const withdrawalsRef = window.dbRef(window.db, 'withdrawals');
                const withdrawalsQuery = window.dbQuery(withdrawalsRef, window.dbOrderByChild('userId'), window.dbEqualTo(currentUser.id));
                const withdrawalsSnapshot = await window.dbGet(withdrawalsQuery);

                const transactions = [];

                if (depositsSnapshot.exists()) {
                    Object.values(depositsSnapshot.val()).forEach(deposit => {
                        transactions.push({ ...deposit, type: 'deposit' });
                    });
                }

                if (withdrawalsSnapshot.exists()) {
                    Object.values(withdrawalsSnapshot.val()).forEach(withdraw => {
                        transactions.push({ ...withdraw, type: 'withdraw' });
                    });
                }

                if (transactions.length === 0) {
                    historyBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="empty-state">
                                <div class="empty-state-icon">üìä</div>
                                <div>No transaction history yet</div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Sort by date
                transactions.sort((a, b) => b.createdAt - a.createdAt);

                historyBody.innerHTML = '';
                transactions.forEach(tx => {
                    const row = document.createElement('tr');
                    const statusClass = `status-${tx.status}`;
                    const typeIcon = tx.type === 'deposit' ? 'üì•' : 'üì§';
                    const amountColor = tx.type === 'deposit' ? 'var(--success-color)' : 'var(--danger-color)';

                    row.innerHTML = `
                        <td>${typeIcon} ${tx.type.toUpperCase()}</td>
                        <td style="color: ${amountColor}; font-weight: bold;">$${tx.amount.toFixed(2)}</td>
                        <td>${new Date(tx.createdAt).toLocaleString()}</td>
                        <td><span class="status-badge ${statusClass}">${tx.status.toUpperCase()}</span></td>
                    `;
                    historyBody.appendChild(row);
                });

            } catch (error) {
                console.error('Error loading history:', error);
                historyBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--danger-color);">Error loading history</td></tr>';
            }
        }

        // Load Activities
        async function loadActivities() {
            const activitiesBody = document.getElementById('activitiesTableBody');
            activitiesBody.innerHTML = '<tr><td colspan="3" style="text-align: center;">Loading...</td></tr>';

            try {
                const activitiesRef = window.dbRef(window.db, `activities/${currentUser.id}`);
                const snapshot = await window.dbGet(activitiesRef);

                if (!snapshot.exists()) {
                    activitiesBody.innerHTML = `
                        <tr>
                            <td colspan="3" class="empty-state">
                                <div class="empty-state-icon">üìù</div>
                                <div>No activities yet</div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                const activities = Object.values(snapshot.val());
                activities.sort((a, b) => b.timestamp - a.timestamp);

                activitiesBody.innerHTML = '';
                activities.forEach(activity => {
                    const row = document.createElement('tr');
                    const icon = getActivityIcon(activity.type);
                    
                    row.innerHTML = `
                        <td>${icon} ${activity.type.replace('_', ' ').toUpperCase()}</td>
                        <td>${activity.description}</td>
                        <td>${new Date(activity.timestamp).toLocaleString()}</td>
                    `;
                    activitiesBody.appendChild(row);
                });

            } catch (error) {
                console.error('Error loading activities:', error);
                activitiesBody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--danger-color);">Error loading activities</td></tr>';
            }
        }

        // Log Activity
        async function logActivity(userId, type, description, amount) {
            try {
                const activitiesRef = window.dbRef(window.db, `activities/${userId}`);
                const newActivityRef = window.dbPush(activitiesRef);
                
                await window.dbSet(newActivityRef, {
                    type: type,
                    description: description,
                    amount: amount,
                    timestamp: Date.now()
                });
            } catch (error) {
                console.error('Error logging activity:', error);
            }
        }

        // Get Activity Icon
        function getActivityIcon(type) {
            const icons = {
                'plan_purchase': 'üõí',
                'claim_earnings': 'üí∞',
                'deposit_request': 'üì•',
                'withdraw_request': 'üì§',
                'referral_bonus': 'üéÅ',
                'referral_commission': 'üíµ',
                'redeem_code': 'üé´'
            };
            return icons[type] || 'üìå';
        }

        // Referral Functions
        async function loadReferralData() {
            const userRef = window.dbRef(window.db, `users/${currentUser.id}`);
            
            window.dbOnValue(userRef, async (snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    
                    // Update stats
                    const referrals = userData.referrals || [];
                    document.getElementById('totalReferrals').textContent = referrals.length;
                    document.getElementById('totalReferralEarnings').textContent = `$${(userData.referralEarnings || 0).toFixed(2)}`;
                    
                    // Calculate monthly earnings (simplified)
                    document.getElementById('monthlyEarnings').textContent = `$${(userData.referralEarnings || 0).toFixed(2)}`;
                    
                    // Set referral link
                    const referralLink = `http://t.me/Exotix_Robot/myapp?ref=${currentUser.id}`;
                    document.getElementById('referralLink').value = referralLink;
                }
            });
        }

        // Show Referral List
        async function showReferralList() {
            const referralList = document.getElementById('referralList');
            const button = event.target;

            if (referralList.style.display === 'none' || !referralList.style.display) {
                showLoading(true);

                try {
                    const userRef = window.dbRef(window.db, `users/${currentUser.id}`);
                    const snapshot = await window.dbGet(userRef);
                    const userData = snapshot.val();
                    const referrals = userData.referrals || [];

                    if (referrals.length === 0) {
                        referralList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">üë•</div>
                                <div>No referrals yet</div>
                                <div style="margin-top: 10px; color: var(--text-secondary);">Share your link to start earning</div>
                            </div>
                        `;
                    } else {
                        referralList.innerHTML = '';
                        
                        for (const referralId of referrals) {
                            const refUserRef = window.dbRef(window.db, `users/${referralId}`);
                            const refSnapshot = await window.dbGet(refUserRef);
                            
                            if (refSnapshot.exists()) {
                                const refUser = refSnapshot.val();
                                const commission = (refUser.totalInvested || 0) * REFERRAL_COMMISSION;
                                
                                const item = document.createElement('div');
                                item.className = 'referral-item';
                                item.innerHTML = `
                                    <img src="${refUser.photoUrl || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%236C5CE7%22/%3E%3Ctext x=%2250%22 y=%2265%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22%3E${refUser.firstName.charAt(0)}%3C/text%3E%3C/svg%3E'}" 
                                         alt="${refUser.firstName}" class="referral-avatar">
                                    <div class="referral-info">
                                        <div class="referral-name">${refUser.firstName} ${refUser.lastName || ''}</div>
                                        <div class="referral-earnings">Balance: $${(refUser.balance || 0).toFixed(2)} | Your Commission: $${commission.toFixed(2)}</div>
                                    </div>
                                `;
                                referralList.appendChild(item);
                            }
                        }
                    }

                    referralList.style.display = 'grid';
                    button.textContent = 'üîº Hide My Referrals';
                    showLoading(false);

                } catch (error) {
                    console.error('Error loading referrals:', error);
                    showToast('Error loading referrals', 'error');
                    showLoading(false);
                }
            } else {
                referralList.style.display = 'none';
                button.textContent = 'üë• Show My Referrals';
            }
        }

        // Share on Telegram
        function shareOnTelegram() {
            const referralLink = document.getElementById('referralLink').value;
            const message = `üöÄ Join Exotix - Professional Crypto Trading Platform!\n\nüí∞ Earn passive income with our investment plans\nüéÅ Get $0.20 signup bonus\n\nJoin now: ${referralLink}`;
            
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(message)}`);
            } else {
                window.open(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(message)}`, '_blank');
            }
        }

        // Update Profile
        function updateProfile() {
            document.getElementById('profileName').textContent = `${currentUser.firstName} ${currentUser.lastName || ''}`;
            document.getElementById('profileUserId').textContent = currentUser.id;
            
            const avatar = document.getElementById('profileAvatar');
            if (currentUser.photoUrl) {
                avatar.src = currentUser.photoUrl;
            } else {
                avatar.src = `data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%236C5CE7%22/%3E%3Ctext x=%2250%22 y=%2265%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22%3E${currentUser.firstName.charAt(0)}%3C/text%3E%3C/svg%3E`;
            }
        }

        // Redeem Code
        async function redeemCode() {
            const code = document.getElementById('redeemCode').value.trim().toUpperCase();

            if (!code || code.length !== 8) {
                showToast('Please enter a valid 8-digit code', 'warning');
                return;
            }

            showLoading(true);

            try {
                const codesRef = window.dbRef(window.db, 'redeem_codes');
                const codeQuery = window.dbQuery(codesRef, window.dbOrderByChild('code'), window.dbEqualTo(code));
                const snapshot = await window.dbGet(codeQuery);

                if (!snapshot.exists()) {
                    showToast('Invalid redemption code', 'error');
                    showLoading(false);
                    return;
                }

                const codeData = Object.values(snapshot.val())[0];
                const codeKey = Object.keys(snapshot.val())[0];

                if (codeData.used) {
                    showToast('This code has already been used', 'error');
                    showLoading(false);
                    return;
                }

                if (codeData.usedBy && codeData.usedBy.includes(currentUser.id)) {
                    showToast('You have already used this code', 'error');
                    showLoading(false);
                    return;
                }

                // Update code
                const usedBy = codeData.usedBy || [];
                usedBy.push(currentUser.id);

                const codeRef = window.dbRef(window.db, `redeem_codes/${codeKey}`);
                await window.dbUpdate(codeRef, {
                    used: usedBy.length >= codeData.maxUses,
                    usedBy: usedBy,
                    usedCount: usedBy.length
                });

                // Update user balance
                const userRef = window.dbRef(window.db, `users/${currentUser.id}`);
                const userSnapshot = await window.dbGet(userRef);
                const userData = userSnapshot.val();

                const newBalance = userData.balance + codeData.amount;

                await window.dbUpdate(userRef, {
                    balance: newBalance
                });

                // Log activity
                await logActivity(currentUser.id, 'redeem_code', `Redeemed code for $${codeData.amount}`, codeData.amount);

                // Send notification
                await sendTelegramNotification(currentUser.id, `üéÅ Successfully redeemed code! You received $${codeData.amount}!`);

                document.getElementById('redeemCode').value = '';
                showToast(`Successfully redeemed $${codeData.amount}!`, 'success');
                showLoading(false);

            } catch (error) {
                console.error('Error redeeming code:', error);
                showToast('Error redeeming code', 'error');
                showLoading(false);
            }
        }

        // Utility Functions
        function switchSection(section) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));

            // Show selected section
            const sectionMap = {
                'trade': 'tradeSection',
                'myTrades': 'myTradesSection',
                'wallet': 'walletSection',
                'referrals': 'referralsSection',
                'profile': 'profileSection'
            };

            document.getElementById(sectionMap[section]).classList.add('active');
        }

        function formatTime(ms) {
            const hours = Math.floor(ms / (1000 * 60 * 60));
            const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((ms % (1000 * 60)) / 1000);

            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.value;

            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!', 'success');
            }).catch(() => {
                showToast('Failed to copy', 'error');
            });
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('active');
            } else {
                loading.classList.remove('active');
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} active`;

            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        async function sendTelegramNotification(userId, message) {
            try {
                if (userId === 'ADMIN') {
                    // Send to admin chat (you need to set this up)
                    return;
                }

                const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
                await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: userId,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
            } catch (error) {
                console.error('Error sending notification:', error);
            }
        }

        function startPriceUpdates() {
            if (priceUpdateInterval) clearInterval(priceUpdateInterval);

            priceUpdateInterval = setInterval(() => {
                document.querySelectorAll('.live-price').forEach((priceElement, index) => {
                    const plan = tradingPlans[index];
                    if (plan) {
                        const newPrice = (plan.price * (0.95 + Math.random() * 0.1)).toFixed(2);
                        const change = (Math.random() * 10 - 5).toFixed(2);
                        const changeClass = change >= 0 ? 'price-up' : 'price-down';
                        const changeSymbol = change >= 0 ? '‚ñ≤' : '‚ñº';

                        priceElement.innerHTML = `$${newPrice} <span class="price-change ${changeClass}">${changeSymbol} ${Math.abs(change)}%</span>`;
                    }
                });
            }, 5000);
        }

        // Initialize app when page loads
        window.addEventListener('load', initApp);
    </script>
</body>
</html>
