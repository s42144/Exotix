<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exotix - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
            --dark-light: #334155;
            --light: #f1f5f9;
            --white: #ffffff;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 30px 20px;
            background: var(--gradient);
            color: white;
        }

        .sidebar-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            color: #64748b;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background: #f1f5f9;
            color: var(--primary);
        }

        .menu-item.active {
            background: #f1f5f9;
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .menu-item i {
            font-size: 20px;
            width: 25px;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 30px;
        }

        .page-header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .page-header h2 {
            font-size: 28px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .page-header p {
            color: #64748b;
            font-size: 14px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .stat-icon.blue {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
        }

        .stat-icon.green {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary);
        }

        .stat-icon.red {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .stat-icon.yellow {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
        }

        /* Content Section */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .card-header h3 {
            font-size: 20px;
            color: var(--dark);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f8fafc;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
            color: #64748b;
            font-size: 14px;
        }

        tr:hover {
            background: #f8fafc;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Badges */
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .badge-primary {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 22px;
            color: var(--dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
            min-width: 300px;
        }

        .notification.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
            }
            to {
                transform: translateX(0);
            }
        }

        .notification.success {
            border-left: 4px solid var(--secondary);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        /* Loading */
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* User Avatar */
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        /* Search */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
        }

        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }

            .sidebar-header h1,
            .sidebar-header p,
            .menu-item span {
                display: none;
            }

            .main-content {
                margin-left: 70px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h1><i class="fas fa-shield-alt"></i> Exotix</h1>
            <p>Admin Panel</p>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item active" onclick="showSection('dashboard')">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </div>
            <div class="menu-item" onclick="showSection('users')">
                <i class="fas fa-users"></i>
                <span>Users</span>
            </div>
            <div class="menu-item" onclick="showSection('deposits')">
                <i class="fas fa-arrow-down"></i>
                <span>Deposits</span>
            </div>
            <div class="menu-item" onclick="showSection('withdrawals')">
                <i class="fas fa-arrow-up"></i>
                <span>Withdrawals</span>
            </div>
            <div class="menu-item" onclick="showSection('trades')">
                <i class="fas fa-chart-line"></i>
                <span>Trades</span>
            </div>
            <div class="menu-item" onclick="showSection('plans')">
                <i class="fas fa-briefcase"></i>
                <span>Plans</span>
            </div>
            <div class="menu-item" onclick="showSection('tasks')">
                <i class="fas fa-tasks"></i>
                <span>Tasks</span>
            </div>
            <div class="menu-item" onclick="showSection('redeem')">
                <i class="fas fa-gift"></i>
                <span>Redeem Codes</span>
            </div>
            <div class="menu-item" onclick="showSection('settings')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboardSection" class="content-section active">
            <div class="page-header">
                <h2>Dashboard</h2>
                <p>Overview of your platform</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-value">$<span id="totalDeposits">0</span></div>
                    <div class="stat-label">Total Deposits</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon red">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="stat-value">$<span id="totalWithdrawals">0</span></div>
                    <div class="stat-label">Total Withdrawals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon yellow">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value" id="activeTrades">0</div>
                    <div class="stat-label">Active Trades</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Recent Activities</h3>
                </div>
                <div id="recentActivities">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="usersSection" class="content-section">
            <div class="page-header">
                <h2>User Management</h2>
                <p>Manage all platform users</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>All Users</h3>
                    <button class="btn btn-primary" onclick="showModal('addUserModal')">
                        <i class="fas fa-plus"></i> Add User
                    </button>
                </div>
                <div class="search-box">
                    <input type="text" id="userSearch" placeholder="Search users..." onkeyup="searchUsers()">
                    <i class="fas fa-search"></i>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Username</th>
                                <th>Balance</th>
                                <th>Total Deposits</th>
                                <th>Referrals</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr>
                                <td colspan="7" style="text-align: center;">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Deposits Section -->
        <div id="depositsSection" class="content-section">
            <div class="page-header">
                <h2>Deposit Management</h2>
                <p>Approve or reject deposit requests</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Pending Deposits</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Amount</th>
                                <th>TX Hash</th>
                                <th>Memo</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="depositsTable">
                            <tr>
                                <td colspan="7" style="text-align: center;">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Withdrawals Section -->
        <div id="withdrawalsSection" class="content-section">
            <div class="page-header">
                <h2>Withdrawal Management</h2>
                <p>Approve or reject withdrawal requests</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Pending Withdrawals</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Amount</th>
                                <th>Address</th>
                                <th>Memo</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalsTable">
                            <tr>
                                <td colspan="7" style="text-align: center;">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Trades Section -->
        <div id="tradesSection" class="content-section">
            <div class="page-header">
                <h2>Trade Management</h2>
                <p>View and manage all trades</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>All Trades</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Pair</th>
                                <th>Investment</th>
                                <th>Daily Earning</th>
                                <th>Progress</th>
                                <th>Total Earned</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="tradesTable">
                            <tr>
                                <td colspan="7" style="text-align: center;">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Plans Section -->
        <div id="plansSection" class="content-section">
            <div class="page-header">
                <h2>Plan Management</h2>
                <p>Manage trading plans</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Trading Plans</h3>
                    <button class="btn btn-primary" onclick="showModal('addPlanModal')">
                        <i class="fas fa-plus"></i> Add Plan
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Pair</th>
                                <th>Price</th>
                                <th>Daily Earning</th>
                                <th>Duration</th>
                                <th>Min. Investment</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="plansTable">
                            <tr>
                                <td colspan="6" style="text-align: center;">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tasks Section -->
        <div id="tasksSection" class="content-section">
            <div class="page-header">
                <h2>Task Management</h2>
                <p>Create and manage tasks</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>All Tasks</h3>
                    <button class="btn btn-primary" onclick="showModal('addTaskModal')">
                        <i class="fas fa-plus"></i> Add Task
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Reward</th>
                                <th>Link</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tasksTable">
                            <tr>
                                <td colspan="5" style="text-align: center;">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Redeem Codes Section -->
        <div id="redeemSection" class="content-section">
            <div class="page-header">
                <h2>Redeem Code Management</h2>
                <p>Generate and manage redemption codes</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Generate Redeem Code</h3>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Min Amount ($)</label>
                        <input type="number" id="redeemMinAmount" value="0.10" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Max Amount ($)</label>
                        <input type="number" id="redeemMaxAmount" value="1.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Max Uses</label>
                        <input type="number" id="redeemMaxUses" value="1">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generateRedeemCode()">
                    <i class="fas fa-gift"></i> Generate Code
                </button>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>All Redeem Codes</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Min Amount</th>
                                <th>Max Amount</th>
                                <th>Max Uses</th>
                                <th>Used Count</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="redeemCodesTable">
                            <tr>
                                <td colspan="7" style="text-align: center;">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settingsSection" class="content-section">
            <div class="page-header">
                <h2>Platform Settings</h2>
                <p>Configure platform settings</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>General Settings</h3>
                </div>
                <div class="form-group">
                    <label>Platform Name</label>
                    <input type="text" id="platformName" value="Exotix">
                </div>
                <div class="form-group">
                    <label>Minimum Deposit ($)</label>
                    <input type="number" id="minDeposit" value="30">
                </div>
                <div class="form-group">
                    <label>Minimum Withdrawal ($)</label>
                    <input type="number" id="minWithdrawal" value="0.10" step="0.01">
                </div>
                <div class="form-group">
                    <label>Referral Bonus ($)</label>
                    <input type="number" id="referralBonus" value="0.20" step="0.01">
                </div>
                <div class="form-group">
                    <label>Referral Commission (%)</label>
                    <input type="number" id="referralCommission" value="20">
                </div>
                <button class="btn btn-primary" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Telegram Bot Settings</h3>
                </div>
                <div class="form-group">
                    <label>Bot Token</label>
                    <input type="text" id="botToken" value="7930967027:AAG3AkEZrkKGxTFOyVHwN8VpA9HgusAdRmw">
                </div>
                <div class="form-group">
                    <label>Bot Link</label>
                    <input type="text" id="botLink" value="http://t.me/Exotix_Robot/myapp">
                </div>
                <button class="btn btn-primary" onclick="saveBotSettings()">
                    <i class="fas fa-save"></i> Save Bot Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit User</h3>
                <button class="close-modal" onclick="closeModal('editUserModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="editUsername">
            </div>
            <div class="form-group">
                <label>Balance ($)</label>
                <input type="number" id="editBalance" step="0.01">
            </div>
            <div class="form-group">
                <label>Telegram ID</label>
                <input type="text" id="editTelegramId">
            </div>
            <button class="btn btn-primary" onclick="updateUser()">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Task</h3>
                <button class="close-modal" onclick="closeModal('addTaskModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="taskTitle">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="taskDescription" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Reward ($)</label>
                <input type="number" id="taskReward" step="0.01">
            </div>
            <div class="form-group">
                <label>Task Link</label>
                <input type="text" id="taskLink">
            </div>
            <div class="form-group">
                <label>Icon (Font Awesome class)</label>
                <input type="text" id="taskIcon" placeholder="fas fa-star">
            </div>
            <button class="btn btn-primary" onclick="addTask()">
                <i class="fas fa-plus"></i> Add Task
            </button>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div id="notificationContent"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, update, push, onValue, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBfR97veh6idxb81mH6N5_Gq8-CpW2D7bE",
            authDomain: "jbhigfi.firebaseapp.com",
            databaseURL: "https://jbhigfi-default-rtdb.firebaseio.com",
            projectId: "jbhigfi",
            storageBucket: "jbhigfi.firebasestorage.app",
            messagingSenderId: "736760492095",
            appId: "1:736760492095:web:47b94412495e21c561c88a",
            measurementId: "G-ZZMHC9RTVT"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.db = database;
        window.dbRef = ref;
        window.dbSet = set;
        window.dbGet = get;
        window.dbUpdate = update;
        window.dbPush = push;
        window.dbOnValue = onValue;
        window.dbRemove = remove;

        // Telegram Bot API
        const TELEGRAM_BOT_TOKEN = '7930967027:AAG3AkEZrkKGxTFOyVHwN8VpA9HgusAdRmw';
        const TELEGRAM_API_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}`;

        window.sendTelegramNotification = async function(chatId, message) {
            try {
                const response = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                return await response.json();
            } catch (error) {
                console.error('Telegram notification error:', error);
            }
        };

        // Initialize
        window.initAdmin = async function() {
            loadDashboard();
            loadUsers();
            loadDeposits();
            loadWithdrawals();
            loadTrades();
            loadTasks();
            loadRedeemCodes();
        };

        initAdmin();
    </script>

    <script>
        let currentEditUserId = null;

        // Navigation
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.menu-item').forEach(el => {
                el.classList.remove('active');
            });

            const sectionMap = {
                'dashboard': 'dashboardSection',
                'users': 'usersSection',
                'deposits': 'depositsSection',
                'withdrawals': 'withdrawalsSection',
                'trades': 'tradesSection',
                'plans': 'plansSection',
                'tasks': 'tasksSection',
                'redeem': 'redeemSection',
                'settings': 'settingsSection'
            };

            document.getElementById(sectionMap[section]).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Dashboard
        async function loadDashboard() {
            // Load stats
            const usersRef = window.dbRef(window.db, 'users');
            const usersSnapshot = await window.dbGet(usersRef);
            
            let totalUsers = 0;
            let totalDeposits = 0;
            let totalWithdrawals = 0;

            if (usersSnapshot.exists()) {
                const users = Object.values(usersSnapshot.val());
                totalUsers = users.length;
                totalDeposits = users.reduce((sum, u) => sum + (u.totalDeposits || 0), 0);
                totalWithdrawals = users.reduce((sum, u) => sum + (u.totalWithdrawals || 0), 0);
            }

            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalDeposits').textContent = totalDeposits.toFixed(2);
            document.getElementById('totalWithdrawals').textContent = totalWithdrawals.toFixed(2);

            // Load active trades
            const tradesRef = window.dbRef(window.db, 'trades');
            const tradesSnapshot = await window.dbGet(tradesRef);
            
            let activeTrades = 0;
            if (tradesSnapshot.exists()) {
                Object.values(tradesSnapshot.val()).forEach(userTrades => {
                    Object.values(userTrades).forEach(trade => {
                        if (trade.status === 'active') activeTrades++;
                    });
                });
            }

            document.getElementById('activeTrades').textContent = activeTrades;

            // Load recent activities
            loadRecentActivities();
        }

        async function loadRecentActivities() {
            const container = document.getElementById('recentActivities');
            container.innerHTML = '<div class="spinner"></div>';

            const activitiesRef = window.dbRef(window.db, 'activities');
            const snapshot = await window.dbGet(activitiesRef);

            container.innerHTML = '';

            if (!snapshot.exists()) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-list"></i><h3>No Activities</h3></div>';
                return;
            }

            const allActivities = [];
            Object.entries(snapshot.val()).forEach(([userId, userActivities]) => {
                Object.values(userActivities).forEach(activity => {
                    allActivities.push({ ...activity, userId });
                });
            });

            allActivities.sort((a, b) => b.timestamp - a.timestamp);
            const recent = allActivities.slice(0, 10);

            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    ${recent.map(activity => `
                        <tr>
                            <td>${activity.userId}</td>
                            <td><span class="badge badge-primary">${activity.type.replace('_', ' ').toUpperCase()}</span></td>
                            <td>${activity.description}</td>
                            <td>${new Date(activity.timestamp).toLocaleString()}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            container.appendChild(table);
        }

        // Users
        async function loadUsers() {
            const usersRef = window.dbRef(window.db, 'users');
            const snapshot = await window.dbGet(usersRef);

            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = '';

            if (!snapshot.exists()) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-users"></i><h3>No Users</h3></div></td></tr>';
                return;
            }

            const users = Object.values(snapshot.val());

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.userId}</td>
                    <td>${user.username || 'User'}</td>
                    <td>$${user.balance.toFixed(2)}</td>
                    <td>$${(user.totalDeposits || 0).toFixed(2)}</td>
                    <td>${user.referralCount || 0}</td>
                    <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="editUser('${user.userId}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-success" onclick="addBalance('${user.userId}')">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deductBalance('${user.userId}')">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#usersTable tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        async function editUser(userId) {
            currentEditUserId = userId;
            const userRef = window.dbRef(window.db, `users/${userId}`);
            const snapshot = await window.dbGet(userRef);

            if (snapshot.exists()) {
                const user = snapshot.val();
                document.getElementById('editUsername').value = user.username || '';
                document.getElementById('editBalance').value = user.balance || 0;
                document.getElementById('editTelegramId').value = user.telegramId || '';
                showModal('editUserModal');
            }
        }

        async function updateUser() {
            if (!currentEditUserId) return;

            const username = document.getElementById('editUsername').value;
            const balance = parseFloat(document.getElementById('editBalance').value);
            const telegramId = document.getElementById('editTelegramId').value;

            const userRef = window.dbRef(window.db, `users/${currentEditUserId}`);
            await window.dbUpdate(userRef, {
                username: username,
                balance: balance,
                telegramId: telegramId
            });

            showNotification('success', 'User updated successfully');
            closeModal('editUserModal');
            loadUsers();
        }

        async function addBalance(userId) {
            const amount = prompt('Enter amount to add:');
            if (!amount || isNaN(amount)) return;

            const userRef = window.dbRef(window.db, `users/${userId}`);
            const snapshot = await window.dbGet(userRef);
            const user = snapshot.val();

            await window.dbUpdate(userRef, {
                balance: user.balance + parseFloat(amount)
            });

            showNotification('success', `Added $${amount} to user balance`);
            loadUsers();
        }

        async function deductBalance(userId) {
            const amount = prompt('Enter amount to deduct:');
            if (!amount || isNaN(amount)) return;

            const userRef = window.dbRef(window.db, `users/${userId}`);
            const snapshot = await window.dbGet(userRef);
            const user = snapshot.val();

            await window.dbUpdate(userRef, {
                balance: Math.max(0, user.balance - parseFloat(amount))
            });

            showNotification('success', `Deducted $${amount} from user balance`);
            loadUsers();
        }

        // Deposits
        async function loadDeposits() {
            const depositsRef = window.dbRef(window.db, 'deposits');
            const snapshot = await window.dbGet(depositsRef);

            const tbody = document.getElementById('depositsTable');
            tbody.innerHTML = '';

            if (!snapshot.exists()) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-inbox"></i><h3>No Deposits</h3></div></td></tr>';
                return;
            }

            const deposits = Object.values(snapshot.val());

            deposits.forEach(deposit => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${deposit.userId}</td>
                    <td>$${deposit.amount.toFixed(2)}</td>
                    <td>${deposit.txHash.substring(0, 15)}...</td>
                    <td>${deposit.memo}</td>
                    <td>${new Date(deposit.createdAt).toLocaleString()}</td>
                    <td><span class="badge badge-${deposit.status === 'approved' ? 'success' : deposit.status === 'rejected' ? 'danger' : 'warning'}">${deposit.status.toUpperCase()}</span></td>
                    <td>
                        ${deposit.status === 'pending' ? `
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-success" onclick="approveDeposit('${deposit.depositId}', '${deposit.userId}', ${deposit.amount})">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="rejectDeposit('${deposit.depositId}', '${deposit.userId}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                        ` : '-'}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function approveDeposit(depositId, userId, amount) {
            if (!confirm('Approve this deposit?')) return;

            // Update deposit status
            const depositRef = window.dbRef(window.db, `deposits/${depositId}`);
            await window.dbUpdate(depositRef, { status: 'approved' });

            // Update user balance
            const userRef = window.dbRef(window.db, `users/${userId}`);
            const snapshot = await window.dbGet(userRef);
            const user = snapshot.val();

            await window.dbUpdate(userRef, {
                balance: user.balance + amount,
                totalDeposits: (user.totalDeposits || 0) + amount,
                hasDeposited: true
            });

            // Send notification
            if (user.telegramId) {
                window.sendTelegramNotification(
                    user.telegramId,
                    `‚úÖ <b>Deposit Approved!</b>\n\n` +
                    `üí∞ Amount: $${amount.toFixed(2)}\n` +
                    `üìÖ Date: ${new Date().toLocaleString()}\n\n` +
                    `Your balance has been updated!`
                );
            }

            showNotification('success', 'Deposit approved successfully');
            loadDeposits();
            loadDashboard();
        }

        async function rejectDeposit(depositId, userId) {
            if (!confirm('Reject this deposit?')) return;

            // Update deposit status
            const depositRef = window.dbRef(window.db, `deposits/${depositId}`);
            await window.dbUpdate(depositRef, { status: 'rejected' });

            // Send notification
            const userRef = window.dbRef(window.db, `users/${userId}`);
            const snapshot = await window.dbGet(userRef);
            const user = snapshot.val();

            if (user.telegramId) {
                window.sendTelegramNotification(
                    user.telegramId,
                    `‚ùå <b>Deposit Rejected</b>\n\n` +
                    `Your deposit request has been rejected.\n` +
                    `Please contact support for more information.`
                );
            }

            showNotification('success', 'Deposit rejected');
            loadDeposits();
        }

        // Withdrawals
        async function loadWithdrawals() {
            const withdrawalsRef = window.dbRef(window.db, 'withdrawals');
            const snapshot = await window.dbGet(withdrawalsRef);

            const tbody = document.getElementById('withdrawalsTable');
            tbody.innerHTML = '';

            if (!snapshot.exists()) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-inbox"></i><h3>No Withdrawals</h3></div></td></tr>';
                return;
            }

            const withdrawals = Object.values(snapshot.val());

            withdrawals.forEach(withdrawal => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${withdrawal.userId}</td>
                    <td>$${withdrawal.amount.toFixed(2)}</td>
                    <td>${withdrawal.address.substring(0, 15)}...</td>
                    <td>${withdrawal.memo || '-'}</td>
                    <td>${new Date(withdrawal.createdAt).toLocaleString()}</td>
                    <td><span class="badge badge-${withdrawal.status === 'approved' ? 'success' : withdrawal.status === 'rejected' ? 'danger' : 'warning'}">${withdrawal.status.toUpperCase()}</span></td>
                    <td>
                        ${withdrawal.status === 'pending' ? `
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-success" onclick="approveWithdrawal('${withdrawal.withdrawId}', '${withdrawal.userId}', ${withdrawal.amount})">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="rejectWithdrawal('${withdrawal.withdrawId}', '${withdrawal.userId}', ${withdrawal.amount})">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                        ` : '-'}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function approveWithdrawal(withdrawId, userId, amount) {
            if (!confirm('Approve this withdrawal?')) return;

            // Update withdrawal status
            const withdrawalRef = window.dbRef(window.db, `withdrawals/${withdrawId}`);
            await window.dbUpdate(withdrawalRef, { status: 'approved' });

            // Update user total withdrawals
            const userRef = window.dbRef(window.db, `users/${userId}`);
            const snapshot = await window.dbGet(userRef);
            const user = snapshot.val();

            await window.dbUpdate(userRef, {
                totalWithdrawals: (user.totalWithdrawals || 0) + amount
            });

            // Send notification
            if (user.telegramId) {
                window.sendTelegramNotification(
                    user.telegramId,
                    `‚úÖ <b>Withdrawal Approved!</b>\n\n` +
                    `üí∞ Amount: $${amount.toFixed(2)}\n` +
                    `üìÖ Date: ${new Date().toLocaleString()}\n\n` +
                    `Your withdrawal has been processed!`
                );
            }

            showNotification('success', 'Withdrawal approved successfully');
            loadWithdrawals();
            loadDashboard();
        }

        async function rejectWithdrawal(withdrawId, userId, amount) {
            if (!confirm('Reject this withdrawal?')) return;

            // Update withdrawal status
            const withdrawalRef = window.dbRef(window.db, `withdrawals/${withdrawId}`);
            await window.dbUpdate(withdrawalRef, { status: 'rejected' });

            // Refund balance
            const userRef = window.dbRef(window.db, `users/${userId}`);
            const snapshot = await window.dbGet(userRef);
            const user = snapshot.val();

            await window.dbUpdate(userRef, {
                balance: user.balance + amount
            });

            // Send notification
            if (user.telegramId) {
                window.sendTelegramNotification(
                    user.telegramId,
                    `‚ùå <b>Withdrawal Rejected</b>\n\n` +
                    `üí∞ Amount: $${amount.toFixed(2)}\n` +
                    `Your balance has been refunded.\n` +
                    `Please contact support for more information.`
                );
            }

            showNotification('success', 'Withdrawal rejected and balance refunded');
            loadWithdrawals();
        }

        // Trades
        async function loadTrades() {
            const tradesRef = window.dbRef(window.db, 'trades');
            const snapshot = await window.dbGet(tradesRef);

            const tbody = document.getElementById('tradesTable');
            tbody.innerHTML = '';

            if (!snapshot.exists()) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-chart-line"></i><h3>No Trades</h3></div></td></tr>';
                return;
            }

            const allTrades = [];
            Object.entries(snapshot.val()).forEach(([userId, userTrades]) => {
                Object.values(userTrades).forEach(trade => {
                    allTrades.push({ ...trade, userId });
                });
            });

            allTrades.forEach(trade => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${trade.userId}</td>
                    <td>${trade.pair}</td>
                    <td>$${trade.investmentAmount.toFixed(2)}</td>
                    <td>$${trade.dailyEarning.toFixed(2)}</td>
                    <td>${trade.daysCompleted}/${trade.duration} days</td>
                    <td>$${trade.totalEarned.toFixed(2)}</td>
                    <td><span class="badge badge-${trade.status === 'active' ? 'success' : 'primary'}">${trade.status.toUpperCase()}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Tasks
        async function loadTasks() {
            const tasksRef = window.dbRef(window.db, 'tasks');
            const snapshot = await window.dbGet(tasksRef);

            const tbody = document.getElementById('tasksTable');
            tbody.innerHTML = '';

            if (!snapshot.exists()) {
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-tasks"></i><h3>No Tasks</h3></div></td></tr>';
                return;
            }

            const tasks = Object.values(snapshot.val());

            tasks.forEach(task => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${task.title}</td>
                    <td>${task.description}</td>
                    <td>$${task.reward.toFixed(2)}</td>
                    <td><a href="${task.link}" target="_blank">View</a></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteTask('${task.taskId}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function addTask() {
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const reward = parseFloat(document.getElementById('taskReward').value);
            const link = document.getElementById('taskLink').value;
            const icon = document.getElementById('taskIcon').value || 'fas fa-star';

            if (!title || !description || !reward || !link) {
                showNotification('error', 'Please fill all fields');
                return;
            }

            const taskId = Date.now().toString();
            const taskRef = window.dbRef(window.db, `tasks/${taskId}`);

            await window.dbSet(taskRef, {
                taskId: taskId,
                title: title,
                description: description,
                reward: reward,
                link: link,
                icon: icon,
                createdAt: Date.now()
            });

            showNotification('success', 'Task added successfully');
            closeModal('addTaskModal');
            loadTasks();

            // Clear form
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskReward').value = '';
            document.getElementById('taskLink').value = '';
            document.getElementById('taskIcon').value = '';
        }

        async function deleteTask(taskId) {
            if (!confirm('Delete this task?')) return;

            const taskRef = window.dbRef(window.db, `tasks/${taskId}`);
            await window.dbRemove(taskRef);

            showNotification('success', 'Task deleted successfully');
            loadTasks();
        }

        // Redeem Codes
        async function generateRedeemCode() {
            const minAmount = parseFloat(document.getElementById('redeemMinAmount').value);
            const maxAmount = parseFloat(document.getElementById('redeemMaxAmount').value);
            const maxUses = parseInt(document.getElementById('redeemMaxUses').value);

            if (minAmount >= maxAmount) {
                showNotification('error', 'Max amount must be greater than min amount');
                return;
            }

            // Generate 8-digit code
            const code = Math.random().toString(36).substring(2, 10).toUpperCase();

            const codeRef = window.dbRef(window.db, `redeemCodes/${code}`);
            await window.dbSet(codeRef, {
                code: code,
                minAmount: minAmount,
                maxAmount: maxAmount,
                maxUses: maxUses,
                usedCount: 0,
                used: false,
                usedBy: [],
                createdAt: Date.now()
            });

            showNotification('success', `Code generated: ${code}`);
            loadRedeemCodes();
        }

        async function loadRedeemCodes() {
            const codesRef = window.dbRef(window.db, 'redeemCodes');
            const snapshot = await window.dbGet(codesRef);

            const tbody = document.getElementById('redeemCodesTable');
            tbody.innerHTML = '';

            if (!snapshot.exists()) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-gift"></i><h3>No Codes</h3></div></td></tr>';
                return;
            }

            const codes = Object.values(snapshot.val());

            codes.forEach(code => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${code.code}</strong></td>
                    <td>$${code.minAmount.toFixed(2)}</td>
                    <td>$${code.maxAmount.toFixed(2)}</td>
                    <td>${code.maxUses}</td>
                    <td>${code.usedCount}</td>
                    <td><span class="badge badge-${code.used ? 'danger' : 'success'}">${code.used ? 'USED' : 'ACTIVE'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteRedeemCode('${code.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function deleteRedeemCode(code) {
            if (!confirm('Delete this code?')) return;

            const codeRef = window.dbRef(window.db, `redeemCodes/${code}`);
            await window.dbRemove(codeRef);

            showNotification('success', 'Code deleted successfully');
            loadRedeemCodes();
        }

        // Settings
        async function saveSettings() {
            const settings = {
                platformName: document.getElementById('platformName').value,
                minDeposit: parseFloat(document.getElementById('minDeposit').value),
                minWithdrawal: parseFloat(document.getElementById('minWithdrawal').value),
                referralBonus: parseFloat(document.getElementById('referralBonus').value),
                referralCommission: parseFloat(document.getElementById('referralCommission').value)
            };

            const settingsRef = window.dbRef(window.db, 'settings');
            await window.dbSet(settingsRef, settings);

            showNotification('success', 'Settings saved successfully');
        }

        async function saveBotSettings() {
            const botSettings = {
                botToken: document.getElementById('botToken').value,
                botLink: document.getElementById('botLink').value
            };

            const settingsRef = window.dbRef(window.db, 'botSettings');
            await window.dbSet(settingsRef, botSettings);

            showNotification('success', 'Bot settings saved successfully');
        }

        // Modal Functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Notification
        function showNotification(type, message) {
            const notification = document.getElementById('notification');
            const content = document.getElementById('notificationContent');

            notification.className = `notification ${type} show`;
            content.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
